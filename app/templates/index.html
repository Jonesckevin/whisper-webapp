<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper Transcription</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Whisper.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1><img src="{{ url_for('static', filename='Whisper.png') }}" alt="Whisper" class="logo"> Whisper Transcription</h1>
        <p class="subtitle">AI-powered audio/video transcription using OpenAI Whisper with GPU acceleration. And it's a WebApp in Docker for all your HALp needs!</p>
    </header>

    <nav class="tabs">
        <button class="tab-btn active" data-tab="upload">üìÅ Upload</button>
        <button class="tab-btn" data-tab="transcribe">üé§ Transcribe</button>
        <button class="tab-btn" data-tab="queue">üìã Queue</button>
        <button class="tab-btn" data-tab="results">üìä Results</button>
        <button class="tab-btn" data-tab="logs">üóíÔ∏è Logs</button>
        <div class="queue-stats" id="queue-stats">
            <span class="stat-item" id="stat-queued">‚è≥ 0</span>
            <span class="stat-item" id="stat-completed">‚úÖ 0</span>
            <span class="stat-item" id="stat-failed">‚ùå 0</span>
        </div>
        <button class="btn btn-secondary refresh-all-btn" onclick="refreshAll()" title="Refresh all data (R)">
            üîÑ Refresh
        </button>
        <button class="btn btn-danger refresh-all-btn" onclick="clearCompletedJobs()" title="Clear all completed jobs and results">
            üóëÔ∏è Clear
        </button>
    </nav>

    <main>
        <!-- Upload Tab -->
        <section id="upload-tab" class="tab-content active">
            <div class="card">
                <h2>üì§ Upload Files</h2>
                <p class="info">
                    Max upload size: <strong>{{ max_upload_gb }}GB</strong> via web interface.<br>
                    For larger files, copy directly to the <code>data/uploads</code> folder.
                </p>
                
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">üìÇ</div>
                    <p>Drag & drop files here or click to browse</p>
                    <p class="supported-formats">
                        Supported: MP3, WAV, FLAC, AAC, M4A, OGG, AMR | MP4, AVI, MOV, MKV, WMV
                    </p>
                    <input type="file" id="file-input" accept=".mp3,.wav,.flac,.aac,.ogg,.m4a,.amr,.mp4,.avi,.mov,.mkv,.flv,.wmv,.webm" multiple hidden>
                </div>
                
                <div id="upload-progress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="upload-progress-fill"></div>
                    </div>
                    <p id="upload-status">Uploading...</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üìÅ Uploaded Files</h2>
                </div>
                <div id="uploads-list" class="file-list">
                    <p class="loading">Loading...</p>
                </div>
            </div>
        </section>

        <!-- Transcribe Tab -->
        <section id="transcribe-tab" class="tab-content">
            <div class="card">
                <h2>üé§ New Transcription Job</h2>
                
                <form id="transcribe-form">
                    <div class="form-group">
                        <label for="file-select">Select File</label>
                        <select id="file-select" required>
                            <option value="">-- Select a file --</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="model-select">Whisper Model</label>
                            <select id="model-select">
                                <option value="tiny">Tiny (~1GB VRAM) - Fastest</option>
                                <option value="base" selected>Base (~1.5GB VRAM) - Recommended</option>
                                <option value="small">Small (~2.5GB VRAM) - Better quality</option>
                                <option value="medium">Medium (~4GB VRAM) - High quality</option>
                                <option value="large">Large (~5.5GB VRAM) - Best quality</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="language-input">Language</label>
                            <input type="text" id="language-input" value="en" placeholder="en, es, fr, de, etc.">
                        </div>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="srt-checkbox">
                            Generate SRT subtitles
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="keep-file-checkbox">
                            Keep original file after transcription
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ‚ñ∂Ô∏è Add to Queue
                    </button>
                </form>
            </div>

            <div class="card">
                <h3>üìñ Model Information</h3>
                <table class="model-info-table" id="model-info-table">
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>VRAM</th>
                            <th>Speed</th>
                            <th>Quality</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="model-table-body">
                        <tr>
                            <td>Tiny</td>
                            <td>~1GB</td>
                            <td>‚ö°‚ö°‚ö°‚ö°‚ö°</td>
                            <td>‚≠ê</td>
                            <td><span class="model-status">‚è≥ Loading...</span></td>
                        </tr>
                        <tr class="recommended">
                            <td>Base ‚úì</td>
                            <td>~1.5GB</td>
                            <td>‚ö°‚ö°‚ö°‚ö°</td>
                            <td>‚≠ê‚≠ê</td>
                            <td><span class="model-status">‚è≥ Loading...</span></td>
                        </tr>
                        <tr>
                            <td>Small</td>
                            <td>~2.5GB</td>
                            <td>‚ö°‚ö°‚ö°</td>
                            <td>‚≠ê‚≠ê‚≠ê</td>
                            <td><span class="model-status">‚è≥ Loading...</span></td>
                        </tr>
                        <tr>
                            <td>Medium</td>
                            <td>~4GB</td>
                            <td>‚ö°‚ö°</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td><span class="model-status">‚è≥ Loading...</span></td>
                        </tr>
                        <tr>
                            <td>Large</td>
                            <td>~5.5GB</td>
                            <td>‚ö°</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td><span class="model-status">‚è≥ Loading...</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Queue Tab -->
        <section id="queue-tab" class="tab-content">
            <div class="queue-grid">
                <div class="card">
                    <h2>‚è≥ Current Job</h2>
                    <div id="current-job">
                        <p class="no-job">No job currently running</p>
                    </div>
                </div>

                <div class="card">
                    <h2>üìã Queued Jobs</h2>
                    <div id="queued-jobs">
                        <p class="no-jobs">No jobs in queue</p>
                    </div>
                </div>
            </div>

            <div class="card completed-jobs-card">
                <div class="card-header">
                    <h2>‚úÖ Recently Completed</h2>
                </div>
                <div id="completed-jobs">
                    <p class="no-jobs">No completed jobs yet</p>
                </div>
            </div>
        </section>

        <!-- Results Tab -->
        <section id="results-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>üìÑ Transcripts & Subtitles</h2>
                </div>
                <div class="search-box">
                    <input type="text" id="results-search" placeholder="üîç Search by filename..." onkeyup="filterResults()">
                </div>
                <div id="results-list" class="file-list">
                    <p class="loading">Loading...</p>
                </div>
            </div>
        </section>

        <!-- Logs Tab -->
        <section id="logs-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>üóíÔ∏è Application Logs</h2>
                    <button class="btn btn-secondary" onclick="downloadLogs()" title="Download logs as text file">
                        üíæ Download
                    </button>
                </div>
                <div id="logs-container" class="logs-viewer">
                    <p class="no-jobs">No logs yet</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Text Viewer Modal -->
    <div id="text-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">File Contents</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="modal-text"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-copy">üìã Copy</button>
                <button class="btn btn-secondary" id="modal-download">‚¨áÔ∏è Download</button>
                <button class="btn btn-primary" id="modal-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirm Delete</h3>
                <button class="modal-close" id="delete-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="delete-filename"></strong>?</p>
                <p class="warning">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="delete-cancel">Cancel</button>
                <button class="btn btn-danger" id="delete-confirm">üóëÔ∏è Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <footer>
        <p>Whisper Transcription Web App | GPU Accelerated | 
           <span id="gpu-status">Checking GPU...</span> | 
           <a href="https://github.com/Jonesckevin/whisper-webapp" target="_blank" rel="noopener noreferrer" style="color: orange; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
               <svg height="16" width="16" viewBox="0 0 16 16" fill="orange" style="vertical-align: middle;">
                   <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
               </svg>
               GitHub - JonesCKevin
           </a>
        </p>
    </footer>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
